<!DOCTYPE html>
<html>
    <head>
        <title>Formosa | Profile</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="../config.js"></script>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous">
            <link rel="icon" type="image/x-icon" href="https://www.fhs.com.vn/favicon.ico">
            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/css/datepicker.min.css" rel="stylesheet">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/locales/bootstrap-datepicker.vi.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

            <style>
                .hidden {
                    display: none;
                }
                .shadow-bg-dark {
                    background-color: #222;
                    box-shadow: 0 0.5rem 1rem rgba(131, 24, 24, 0.5);
                }
                .image-container {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    /* Chi·ªÅu cao c·ªßa m√†n h√¨nh */
                    flex-direction: column;
                }
            </style>

        </head>
    <body class="bg-dark text-light">
        <div class="container-xl mt-5 shadow-lg p-3 mb-5  box-shadow ">
            <div class="row justify-content-center">
                  <div class="shadow-sm p-3 mb-1  rounded form-group d-flex">
                    <input type="text" class="mx-1 form-control bg-dark text-light" name="userId" id="userId" placeholder="ID employee">
                </div>
              </div>
           <div  class="row justify-content-center">
            <table class="table table-bordered border-primary my-2 hidden bg-dark text-light" id="data">
                <tbody>
                  <tr>
                      <th scope="row" colspan="2" class="text-center bg-dark  text-light" id="name-id" onclick="downloadFile()"></th>
                </tr>
                <tr class="bg-secondary">
                    <th scope="row" class="text-center">H·ªç t√™n ti·∫øng Trung</th>
                    <td class="text-center" id="htttrung"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">H·ªç t√™n ti·∫øng Anh</th>
                    <td class="text-center" id="httanh"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y th√°ng nƒÉm sinh</th>
                    <td class="text-center" id="ntnsinh"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y v√†p c√¥ng ty</th>
                    <td class="text-center" id="nccty"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">T√™n b·ªô ph·∫≠n</th>
                    <td class="text-center" id="tenbophan"> </td>
                </tr>
                <tr class="bg-secondary">
                    <th scope="row" class="text-center">T√™n ch·ª©c v·ª•</th>
                    <td class="text-center" id="tenchucvu"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y hi·ªáu l·ª±c c·ªßa ch·ª©c v·ª• hi·ªán t·∫°i</th>
                    <td class="text-center" id="nhlccvht"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ch·ª©c v·ª•</th>
                    <td class="text-center" id="chucvu"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y b·∫Øt ƒë·∫ßu</th>
                    <td class="text-center" id="ngaybatdau"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">C·∫•p b·∫≠c ch·ª©c v·ª•</th>
                    <td class="text-center" id="cbcv"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y b·∫Øt ƒë·∫ßu</th>
                    <td class="text-center" id="ngaybatdau2"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Thang b·∫≠c l∆∞∆°ng</th>
                    <td class="text-center" id="thangbacluong"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y b·∫Øt ƒë·∫ßu</th>
                    <td class="text-center" id="ngaybatdau3"> </td>
                </tr>
                <tr class="bg-secondary">
                    <th scope="row" class="text-center">L∆∞∆°ng c∆° b·∫£n</th>
                    <td class="text-center" id="luongcoban"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y hi·ªáu l·ª±c</th>
                    <td class="text-center" id="ngayhieuluc"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">Ng√†y b·∫Øt ƒë·∫ßu h·ª£p ƒë·ªìng lao ƒë·ªông</th>
                    <td class="text-center" id="nbdhdld"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">ƒê·∫øn ng√†y</th>
                    <td class="text-center" id="denngay"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">ƒê·ªãa ch·ªâ li√™n l·∫°c</th>
                    <td class="text-center" id="diachill"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</th>
                    <td class="text-center" id="dcthuongtru"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">S·ªë ƒëi·ªán tho·∫°i li√™n l·∫°c 1</th>
                    <td class="text-center" id="sdtll1"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">S·ªë ƒëi·ªán tho·∫°i li√™n l·∫°c 2</th>
                    <td class="text-center" id="sdtll2"> </td>
                </tr>
                <tr>
                    <th scope="row" class="text-center">T√™n v·ª£/ch·ªìng</th>
                    <td class="text-center" id="tenvochong"> </td>
                </tr>
                  
                </tbody>
              </table>
           </div>
           <p id="messager" class="text-center text-danger mt-4 hidden">D·ªØ li·ªáu hi·ªán t·∫°i kh√¥ng ƒë√∫ng</p>
           <div class="image-container">
               <img src="../images/load.gif" alt="loading" id="loading" class="hidden">
               <h3 id="loading-text" class="hidden">Loading...</h3>
           </div>
         </div>
          </div>

        <script>
            var dp = $("#datepicker").datepicker( {
                format: "mm-yyyy",
                startView: "months", 
                minViewMode: "months",
                language: "vi"
            });

        

        

        $(document).ready(function () {
            let localStorage_userId = localStorage.getItem("userId");
            $("#userId").val(localStorage_userId);
            setData();
            $("#userId").change(function() {
                setData();
            });
            $('#userId').keyup(function (e) {
                setData();
            });
            $('#userId').keydown(function (e) {
                setData();
            });
            $('#userId').mousedown(function (e) {
                setData();
            });

            function setData() {
                    let id = $("#userId").val();

                    if (id !== "") {
                        $("#name-id").text(id + 'üîΩ');
                        let link = `https://www.fhs.com.tw/ads/api/Furnace/rest/json/hr/s10/${id}`;

                        $("#loading").removeClass("hidden");
                        $("#loading-text").removeClass("hidden");
                        $("#messager").addClass("hidden");
                        $("#data").addClass("hidden");

                        $.ajax({
                            url: CONFIG.path_api,
                            type: "POST",
                            dataType: "json",
                            data: {
                                "link": link
                            },
                            success: function (data) {
                                $("#loading").addClass("hidden");
                                $("#loading-text").addClass("hidden");
                                if (data.length <= 1) {
                                    $("#data").addClass("hidden");
                                    $("#messager").removeClass("hidden");
                                    return;
                                }
                                $("#data").removeClass("hidden");
                                $("#messager").addClass("hidden");
                                data = (data.split("o|o")[0]).split("|");
                                console.log(data);

                                $("#htttrung").text(data[0]);
                                $("#httanh").text(data[1]);
                                $("#ntnsinh").text(data[2]);
                                $("#nccty").text(data[3]);
                                $("#tenbophan").text(data[4]);
                                $("#tenchucvu").text(data[5]);
                                $("#nhlccvht").text(data[6]);
                                $("#chucvu").text(data[7]);
                                $("#ngaybatdau").text(data[8]);
                                $("#cbcv").text(data[9]);
                                $("#ngaybatdau2").text(data[10]);
                                $("#thangbacluong").text(data[11]);
                                $("#ngaybatdau3").text(data[12]);
                                $("#luongcoban").text(data[13]);
                                $("#ngayhieuluc").text(data[14]);
                                $("#nbdhdld").text(data[15]);
                                $("#denngay").text(data[16]);
                                $("#diachill").text(data[17]);
                                $("#dcthuongtru").text(data[18]);
                                $("#sdtll1").text(data[19]);
                                $("#sdtll2").text(data[20]);
                                $("#tenvochong").text(data[21]);

                                localStorage.setItem("userId", id);
                                $('title').text("Formosa | Profile " + data[0] + " - " + data[1]);
                                
                            },
                            error: function (error) {
                                console.log("Error:", error);
                                $("#data").addClass("hidden");
                                $("#messager").removeClass("hidden");
                                $("#loading").addClass("hidden");
                                $("#loading-text").addClass("hidden");
                            }
                        });
                    }
                }
        });

        function downloadFile() {
            let userId = $("#userId").val();
            let nameByUserId = userId + '_profile.xlsx';
            let table = document.getElementById("data");
            let wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
            let wbout = XLSX.write(wb, { bookType: "xlsx", type: "array" });
            let blob = new Blob([wbout], { type: "application/octet-stream" });
            saveAs(blob, nameByUserId);

            toastr.success("ƒê√£ t·∫£i th√†nh c√¥ng " + nameByUserId, "Th√¥ng b√°o");
        }

        
    </script>
    </body>
</html>
