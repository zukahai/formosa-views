<!DOCTYPE html>
<html>
    <head>
        <title>Formosa's employee salary</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="../config.js"></script>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous">
            <link rel="icon" type="image/x-icon" href="https://www.fhs.com.vn/favicon.ico">
            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/css/datepicker.min.css" rel="stylesheet">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/locales/bootstrap-datepicker.vi.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <style>
        .hidden {
            display: none;
        }
        .shadow-bg-dark {
            background-color: #222;
            box-shadow: 0 0.5rem 1rem rgba(131, 24, 24, 0.5);
        }
        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            /* Chi·ªÅu cao c·ªßa m√†n h√¨nh */
            flex-direction: column;
        }
    </style>

        </head>
    <body class="bg-dark text-light">
        <div class="container-xl mt-5 shadow-lg p-3 mb-5  box-shadow ">
            <div class="row justify-content-center">
                  <div class="shadow-sm p-3 mb-1  rounded form-group d-flex">
                    <input type="text" class="mx-1 form-control bg-dark text-light" name="id" id="userId" placeholder="ID employee">
                    <input type="text" class="mx-1 form-control bg-dark text-light" name="datepicker" id="datepicker" placeholder="YY-MM">
                </div>
              </div>
           <div  class="row justify-content-center">
            <table class="table table-bordered border-primary my-2 hidden bg-dark text-light" id="data">
                <tbody>
                  <tr>
                      <th scope="row" colspan="4" class="text-center bg-dark  text-light" id="name-id" onclick="downloadFile()"></th>
                    </tr>
                  <tr>
                    <th scope="row" colspan="2" class="text-center">S·ªë l∆∞·ª£ng ng√†y c√¥ng th√°ng ƒë√≥</th>
                    <td colspan="2" class="text-center" id="slnctd"> </td>
                  </tr>
                  <tr>
                      <th scope="row" colspan="2" class="text-center">ƒêi·ªÉm ƒë√°nh gi√° c·ªßa ch·ªß qu·∫£n</th>
                      <td colspan="2" class="text-center" id="ddgccq"> </td>
                  </tr>
                  <tr>
                      <th scope="row" colspan="2" class="text-center">H·∫°ng m·ª•c</th>
                      <th scope="row" class="text-center">T√™n</th>
                      <th scope="row" class="text-center">S·ªë ti·ªÅn</th>
                  </tr>
                  <tr>
                      <th scope="row" rowspan="32" class="text-center" style="vertical-align : middle;text-align:center;">H·∫°ng m·ª•c l∆∞∆°ng</th>
                      <th scope="row" rowspan="21" class="text-center" style="vertical-align : middle;text-align:center;">H·∫°ng m·ª•c ph·∫£i n·ªôp thu·∫ø</th>
                      <th scope="row" class="text-center">L∆∞∆°ng c∆° b·∫£n</th>
                      <td class="text-center" id="lcb"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ti·ªÅn th∆∞·ªüng nƒÉng su·∫•t</th>
                      <td class="text-center" id="ttns"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ti·ªÅn th∆∞·ªüng ƒëi l√†m ng√†y t·∫øt</th>
                      <td class="text-center" id="ttdlnt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Tr·ª£ c·∫•p ti·ªÅn c∆°m ph·∫£i n·ªôp</th>
                      <td class="text-center" id="tctcpn"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Tr·ª£ c·∫•p ti·ªÅn KTX, ƒëi·ªán n∆∞·ªõc, ƒëi l·∫°i</th>
                      <td class="text-center" id="tctktx"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ti·ªÅn th∆∞·ªüng chuy√™n c·∫ßn</th>
                      <td class="text-center" id="ttcc"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tr·ª±c ban</th>
                      <td class="text-center" id="pctb"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p ng√¥n ng·ªØ</th>
                      <td class="text-center" id="pcnn"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p ƒë·∫∑c bi·ªát</th>
                      <td class="text-center" id="pcdb"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p chuy√™n ng√†nh</th>
                      <td class="text-center" id="pccn"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p t√°c nghi·ªáp</th>
                      <td class="text-center" id="pctacng"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p Khu v·ª±c</th>
                      <td class="text-center" id="pckvuc"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tƒÉng ca ƒë·ªôt xu·∫•t ph·∫£i n·ªôp thu·∫ø</th>
                      <td class="text-center" id="pctcdxpnt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p l√†m th√™m gi·ªù ng√†y ngh·ªâ c√≥ t√≠nh thu·∫ø</th>
                      <td class="text-center" id="pcltgnnctt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tƒÉng ca kh·∫©n c·∫•p ph·∫£i n·ªôp thu·∫ø</th>
                      <td class="text-center" id="pctckcpnt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p ch·ª©c v·ª• ch·ªß qu·∫£n</th>
                      <td class="text-center" id="pccvcq"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Tr·ª£ c·∫•p ti·ªÅn ph√≤ng</th>
                      <td class="text-center" id="tctphong"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√°t b√π</th>
                      <td class="text-center" id="phatbu"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ti·ªÅn th∆∞·ªüng c√¥ng vi·ªác</th>
                      <td class="text-center" id="ttcviec"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√≠ kh√°c</th>
                      <td class="text-center" id="phikhac"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">C·ªông</th>
                      <td class="text-center" id="cong"> </td>
                  </tr>
                  <tr>
                      <th scope="row" rowspan="10" class="text-center" style="vertical-align : middle;text-align:center;">H·∫°ng m·ª•c mi·ªÖn thu·∫ø</th>
                      <th scope="row" class="text-center">Ti·ªÅn ƒë·ªìng ph·ª•c</th>
                      <td class="text-center" id="tiendongphuc"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Tr·ª£ c·∫•p ti·ªÅn c∆°m ƒë∆∞·ª£c mi·ªÖn thu·∫ø</th>
                      <td class="text-center" id="tctcdmt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Tr·ª£ c·∫•p di·ªán tho·∫°i</th>
                      <td class="text-center" id="tcdienthoai"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ti·ªÅn tr·ª£ c·∫•p ngh·ªâ vi·ªác</th>
                      <td class="text-center" id="ttcnghiviec"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tƒÉng ca ng√†y l·∫Ω</th>
                      <td class="text-center" id="pctcnle"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p ƒëi ca</th>
                      <td class="text-center" id="pcdica"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tƒÉng ca ƒë·ªôt xu·∫•t ƒë∆∞·ª£c mi·ªÖn thu·∫ø</th>
                      <td class="text-center" id="pctcdxdmienthue"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p l√†m th√™m cho nh·ªØng ng√†y ngh·ªâ mi·ªÖn thu·∫ø</th>
                      <td class="text-center" id="pcltcnnnmt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tƒÉng ca kh·∫©n c·∫•p ƒë∆∞·ª£c mi·ªÖn thu·∫ø</th>
                      <td class="text-center" id="pctckcduocmienthue"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph·ª• c·∫•p tƒÉng ca v√†o ban ƒë√™m</th>
                      <td class="text-center" id="pctcvaobandem"> </td>
                  </tr>
                  <tr>
                      <th scope="row" rowspan="1" colspan="2" class="text-center" style="vertical-align : middle;text-align:center;">T·ªïng s·ªë ti·ªÅn ph√°t</th>
                      <td class="text-center" id="tongsotienphat"> </td>
                  </tr>
                  <tr>
                      <th scope="row" rowspan="10" class="text-center" style="vertical-align : middle;text-align:center;">H·∫°ng m·ª•c kh·∫•u tr·ª´</th>
                      <th scope="row" rowspan="4" class="text-center" style="vertical-align : middle;text-align:center;">C√≥ th·ªÉ kh·∫•u tr·ª´ thu·∫ø</th>
                      <th scope="row" class="text-center">Ph√≠ b·∫£o hi·ªÉm x√£ h·ªôi</th>
                      <td class="text-center" id="pbhxh"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√≠ b·∫£o hi·ªÉm th·∫•t nghi·ªáp</th>
                      <td class="text-center" id="phibaohiemthatnghiep"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√≠ b·∫£o hi·ªÉm y t·∫ø</th>
                      <td class="text-center" id="phibaohiemyt"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√≠ KTX, ƒëi l·∫°i</th>
                      <td class="text-center" id="phiktxdl"> </td>
                  </tr>
                  <tr>
                      <th scope="row" rowspan="6" class="text-center" style="vertical-align : middle;text-align:center;">Kh√¥ng th·ªÉ kh·∫•u tr·ª´ thu·∫ø</th>
                      <th scope="row" class="text-center">Ti·ªÅn c∆°m</th>
                      <td class="text-center" id="tiencom"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√≠ ƒë·ªìng ph·ª•c</th>
                      <td class="text-center" id="phidongphuc"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Ph√≠ c√¥ng ƒëo√†n</th>
                      <td class="text-center" id="phicongdoan"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Kho·∫£n tr·ª´ kh√°c</th>
                      <td class="text-center" id="khoantrukhac"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Tr·ª´ ti·ªÅn ngh·ªâ ph√©p</th>
                      <td class="text-center" id="trutiennghiphep"> </td>
                  </tr>
                  <tr>
                      <th scope="row" class="text-center">Thu·∫ø thu nh·∫≠p</th>
                      <td class="text-center" id="thuethunhap"> </td>
                  </tr>
                  <tr>
                      <th scope="row" colspan="3" class="text-center">Ti·ªÅn ph√°t th·ª±c t·∫ø</th>
                      <td class="text-center" id="tienphatthucte"> </td>
                  </tr>
                  <tr>
                      <th scope="row" colspan="3" class="text-center">Nh·∫≠n x√©t</th>
                      <td class="text-center" id="nhanxet"> </td>
                  </tr>
                </tbody>
              </table>
           </div>
            <p id="messager" class="text-center text-danger mt-4 hidden">D·ªØ li·ªáu hi·ªán t·∫°i kh√¥ng ƒë√∫ng</p>
            <div class="image-container">
                <img src="../images/load.gif" alt="loading" id="loading" class="hidden">
                <h3 id="loading-text" class="hidden">Loading...</h3>
            </div>
          </div>

        <script>
            var dp = $("#datepicker").datepicker( {
                format: "mm-yyyy",
                startView: "months", 
                minViewMode: "months",
                language: "vi"
            });

        

        

        $(document).ready(function () {

            let localStorage_userId = localStorage.getItem("userId");
            $("#userId").val(localStorage_userId);
            setData();
            function setData() {
                let id = $("#userId").val();
                let year = $("#datepicker").val();

                if (id !== "" && year !== "") {
                    localStorage.setItem("time-fhs", Date.now());
                    $('title').text(id + ' salary ' + year + ' | Formosa');
                    $("#name-id").text(id + 'üîΩ');
                    let link = "https://www.fhs.com.tw/ads/api/Furnace/rest/json/hr/s16/" + id + "vkokv" + year.split("-")[1] + "-" + year.split("-")[0];
                    
                    $("#loading").removeClass("hidden");
                    $("#loading-text").removeClass("hidden");
                    $("#messager").addClass("hidden");
                    $("#data").addClass("hidden");

                    $.ajax({
                        url: CONFIG.path_api,
                        type: "POST",
                        dataType: "json",
                        data: {
                            "link": link
                        },
                        success: function (data) {
                            $("#loading").addClass("hidden");
                            $("#loading-text").addClass("hidden");
                            
                            if (data.length <= 10) {
                                $("#data").addClass("hidden");
                                $("#messager").removeClass("hidden");
                                return;
                            }
                            $("#data").removeClass("hidden");
                            $("#messager").addClass("hidden");
                            data = (data.split("o|o")[0]).split("|");
                            $("#slnctd").text(data[0]);
                            $("#ddgccq").text(data[1]);
                            $("#lcb").text(data[44]);
                            $("#ttns").text(data[2]);
                            $("#ttdlnt").text(data[3]);
                            $("#tctcpn").text(data[4]);
                            $("#tctktx").text(data[5]);
                            $("#ttcc").text(data[6]);
                            $("#pctb").text(data[7]);
                            $("#pcnn").text(data[8]);
                            $("#pcdb").text(data[9]);
                            $("#pccn").text(data[10]);
                            $("#pctacng").text(data[11]);
                            $("#pckvuc").text(data[12]);
                            $("#pctcdxpnt").text(data[13]);
                            $("#pcltgnnctt").text(data[14]);
                            $("#pctckcpnt").text(data[15]);
                            $("#pccvcq").text(data[16]);
                            $("#tctphong").text(data[17]);
                            $("#phatbu").text(data[18]);
                            $("#ttcviec").text(data[19]);
                            $("#phikhac").text(data[20]);
                            $("#cong").text(data[21]);
                            $("#tiendongphuc").text(data[22]);
                            $("#tctcdmt").text(data[23]);
                            $("#tcdienthoai").text(data[24]);
                            $("#ttcnghiviec").text(data[25]);
                            $("#pctcnle").text(data[26]);
                            $("#pcdica").text(data[27]);
                            $("#pctcdxdmienthue").text(data[28]);
                            $("#pcltcnnnmt").text(data[29]);
                            $("#pctckcduocmienthue").text(data[30]);
                            $("#pctcvaobandem").text(data[31]);
                            $("#tongsotienphat").text(data[32]);
                            $("#pbhxh").text(data[33]);
                            $("#phibaohiemthatnghiep").text(data[34]);
                            $("#phibaohiemyt").text(data[35]);
                            $("#phiktxdl").text(data[36]);
                            $("#tiencom").text(data[37]);
                            $("#phidongphuc").text(data[38]);
                            $("#phicongdoan").text(data[39]);
                            $("#khoantrukhac").text(data[40]);
                            $("#trutiennghiphep").text(data[41]);
                            $("#thuethunhap").text(data[42]);
                            $("#tienphatthucte").text(data[43]);
                            $("#nhanxet").text(data[45]);
                            localStorage.setItem("userId", id);

                        },
                        error: function (error) {
                            console.error("Error:", error);
                            $("#data").addClass("hidden");
                            $("#messager").removeClass("hidden");
                            $("#loading").addClass("hidden");
                            $("#loading-text").addClass("hidden");
                        },
                        
                    });
                } else {
                    $("#data").addClass("hidden");
                    $("#messager").removeClass("hidden");
                    $("#loading").addClass("hidden");
                    $("#loading-text").addClass("hidden");

                }
            }

            $("#userId").change(function() {
                setData();
            });
            $('#userId').keyup(function (e) {
                setData();
            });
            $('#userId').keydown(function (e) {
                setData();
            });
            $('#userId').mousedown(function (e) {
                setData();
            });
            $("#datepicker").change(function() {
                setData();
            });
           
        });

        function downloadFile() {
            let userId = $("#userId").val();
            let date = $("#datepicker").val();
            let nameByUserId = userId + "_" + date.split("-")[0] + "_" + date.split("-")[1] + ".xlsx";
            let table = document.getElementById("data");

            let wb = XLSX.utils.book_new();
            let sheet = XLSX.utils.table_to_sheet(table);
            XLSX.utils.book_append_sheet(wb, sheet, "Sheet1");

            let wbout = XLSX.write(wb, { bookType: "xlsx", type: "array" });
            let blob = new Blob([wbout], { type: "application/octet-stream" });
            saveAs(blob, nameByUserId);

            toastr.success("ƒê√£ t·∫£i th√†nh c√¥ng " + nameByUserId, "Th√¥ng b√°o");
        }

        
    </script>
    </body>
</html>
